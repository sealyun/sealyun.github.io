<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>My New Hugo Site </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.40.3" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.ab4b67a3ea25990fa8279f3b7ef08b61.css" rel="stylesheet">
    

    

    
      
    

    
      <link href="https://lameleg.com/posts/index.xml" rel="alternate" type="application/rss+xml" title="My New Hugo Site" />
      <link href="https://lameleg.com/posts/index.xml" rel="feed" type="application/rss+xml" title="My New Hugo Site" />
    

    <meta property="og:title" content="Posts" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://lameleg.com/posts/" />














<meta itemprop="name" content="Posts">
<meta itemprop="description" content="">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Posts"/>
<meta name="twitter:description" content=""/>

  </head>

  <body class="ma0 avenir bg-near-white">

    

  
  
  <header class="cover bg-top" style="background-image: url('https://lameleg.com/images/gohugo-default-sample-hero-image.jpg');">
    <div class="bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://lameleg.com/" class="f3 fw2 hover-white no-underline white-90 dib">
      My New Hugo Site
    </a>
    <div class="flex-l items-center">
      
      








    </div>
  </div>
</nav>

      <div class="tc-l pv4 pv6-l ph3 ph4-ns">
        <h1 class="f2 f-subheadline-l fw2 white-90 mb0 lh-title">
          Posts
        </h1>
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
  <article class="pa3 pa4-ns nested-copy-line-height nested-img">
  <main class="cf ph3 ph5-l pv3 pv4-l f4 tc-l center measure-wide lh-copy mid-gray"></main>
    <section class="flex-ns flex-wrap justify-around mt5">
      
        <div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/kubeadm-source/" class="link black dim">
        
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      k8s离线安装包 三步安装，简单到难以置信
kubeadm源码分析 说句实在话，kubeadm的代码写的真心一般，质量不是很高。
几个关键点来先说一下kubeadm干的几个核心的事：
 kubeadm 生成证书在/etc/kubernetes/pki目录下 kubeadm 生成static pod yaml配置，全部在/etc/kubernetes/manifasts下 kubeadm 生成kubelet配置，kubectl配置等 在/etc/kubernetes下 kubeadm 通过client go去启动dns  kubeadm init 代码入口 cmd/kubeadm/app/cmd/init.go 建议大家去看看cobra
找到Run函数来分析下主要流程：
 如果证书不存在，就创建证书，所以如果我们有自己的证书可以把它放在/etc/kubernetes/pki下即可, 下文细看如果生成证书
	if res, _ := certsphase.UsingExternalCA(i.cfg); !res { if err := certsphase.CreatePKIAssets(i.cfg); err != nil { return err }  创建kubeconfig文件
	if err := kubeconfigphase.CreateInitKubeConfigFiles(kubeConfigDir, i.cfg); err != nil { return err }  创建manifest文件，etcd apiserver manager scheduler都在这里创建, 可以看到如果你的配置文件里已经写了etcd的地址了，就不创建了，这我们就可以自己装etcd集群，而不用默认单点的etcd，很有用
controlplanephase.CreateInitStaticPodManifestFiles(manifestDir, i.
    </div>
  </div>
</div>
</div>
      
        <div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/kubernetes-dns/" class="link black dim">
        
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
       dns之锅 kubectl run --namespace=kube-system access -it --image busybox -- /bin/sh [root@fortest1513671663-master-00 ~]# kubectl exec access-79f4758b79-qwl8s nslookup kubernetes-dashboard.kube-system.svc -n kube-system Server: 10.96.0.10 Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local Name: kubernetes-dashboard.kube-system.svc Address 1: 10.110.146.248 kubernetes-dashboard.kube-system.svc.cluster.local [root@fortest1513671663-master-00 ~]# kubectl get svc kubernetes-dashboard -n kube-system NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes-dashboard NodePort 10.110.146.248 &lt;none&gt; 443:30089/TCP 27m  
    </div>
  </div>
</div>
</div>
      
        <div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/micro-architecture/" class="link black dim">
        
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
       论微架构 
    </div>
  </div>
</div>
</div>
      
        <div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/moby_discussion/" class="link black dim">
        
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      社区再无docker, 只有moby 
看到github上面docker项目更名为moby，不禁小吃一惊，喜忧参半，docker在商业化的道路上走的这么彻底。。。
moby简介 官方解释：一个开放的组装特定容器系统的框架，不再重复造轮子！
提供一套标准的组件和框架去定制平台。
    </div>
  </div>
</div>
</div>
      
        <div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/offline-install/" class="link black dim">
        
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
       安装包列表 [kubernetes1.10.3离线安装包 审核中]()  全部使用当前最新版本组建 Cgroup driver自动检测，99%以上一键安装成功，遇到任何问题远程协助解决 优化dashboard grafana等yaml配置 DNS双副本高可用  kubernetes1.9.2离线安装包 kubernetes1.8.1离线安装包 推荐使用1.9.2以上版本 
    </div>
  </div>
</div>
</div>
      
        <div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/revolution/" class="link black dim">
        
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
       程序员解放革命 成为专业领域的人才 技术特点  复用必 专业性  工作模式对比  一般：在自己公司做不同的事 外派：到不同的公司，做不同的事 外包：在自己公司做不同公司的事 我们：在不同的公司做专业的事  路线 - 充分实现人才价值  短期 : 容器领域实现自己专业技术复用 中期 ：计算机领域很多专业通用技术人才复用, 公司雇用 长期 ：所有领域专业人才复用, 平台化，去公司化, 实现“人才调度”  
    </div>
  </div>
</div>
</div>
      
        <div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/rpc-protobuf/" class="link black dim">
        
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      golang基于protobuf的rpc使用 基本安装什么的在此不再赘述，不知道的看这里
proto文件 cat helloworld.proto
syntax = &quot;proto3&quot;; option java_multiple_files = true; option java_package = &quot;io.grpc.examples.helloworld&quot;; option java_outer_classname = &quot;HelloWorldProto&quot;; package helloworld; // The greeting service definition. service Greeter { // Sends a greeting rpc SayHello (HelloRequest) returns (HelloReply) {} } // The request message containing the user's name. message HelloRequest { string name = 1; } // The response message containing the greetings message HelloReply { string message = 1; }  那几个生成java代码的定义就无视了，关键看service 定义了一个接口，然后定义了两条消息，分别是请求和回复的消息格式。
    </div>
  </div>
</div>
</div>
      
        <div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/runc/" class="link black dim">
        
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      runc 架构破析 这里的spec.Process就是我们真正要运行的容器中的进程。
return r.run(&amp;spec.Process)  把这个塞到libcontainer.Process里去了：
 lp := &amp;libcontainer.Process{ Args: p.Args, Env: p.Env, // TODO: fix libcontainer's API to better support uid/gid in a typesafe way. User: fmt.Sprintf(&quot;%d:%d&quot;, p.User.UID, p.User.GID), Cwd: p.Cwd, Label: p.SelinuxLabel, NoNewPrivileges: &amp;p.NoNewPrivileges, AppArmorProfile: p.ApparmorProfile, }  我试了个busybox的容器，把p.Args和p.Env打印出来看一下,正是config.json中的内容：
fmt.Println(&quot;Args: &quot;, p.Args, &quot;env&quot;, p.Env) //Args: [sh] env [PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin TERM=xterm]  这里真正调用的是container的Start 或者Run方法
 var ( startFn = r.container.Start ) if !r.create { startFn = r.container.Run } if err = startFn(process); err !
    </div>
  </div>
</div>
</div>
      
        <div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/scratch/" class="link black dim">
        
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
      如何让镜像尽可能小 很容器想到from scratch, 就是没任何基础镜像
FROM scratch COPY p / ENTRYPOINT [&quot;/p&quot;]  有几点要注意：
 ENTRYPOINT 或者CMD 必须要用[]这种模式，如果直接/p会用sh去启动，而scratch没有shell导致失败 二进制程序必须静态编译，也就是不能依赖libc什么的动态库  动态编译的bin程序：
[root@dev-86-205 ci-sftp]# ldd p linux-vdso.so.1 =&gt; (0x00007ffd6ef7b000) libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007fa28f94e000) libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fa28f58d000) /lib64/ld-linux-x86-64.so.2 (0x00007fa28fb72000)  这种情况下出来的bin程序可能会出现问题：
standard_init_linux.go:175: exec user process caused &quot;no such file or directory”  静态编译的bin程序,这是我们scratch需要的：
[root@dev-86-205 ci-sftp]# ldd p 不是动态可执行文件  golang中静态编译命令：
go build --ldflags '-linkmode external -extldflags &quot;-static”'  如果不静态编译那可能得拷贝一堆动态库到镜像中，很多lowB就是那么做的
    </div>
  </div>
</div>
</div>
      
        <div class="relative w-100 w-30-l mb4 bg-white"><div class="relative w-100 mb4 bg-white nested-copy-line-height">
  <div class="bg-white mb3 pa4 gray overflow-hidden">
    <span class="f6 db">Posts</span>
    <h1 class="f3 near-black">
      <a href="/posts/sealyun-strengths/" class="link black dim">
        
      </a>
    </h1>
    <div class="nested-links f5 lh-copy nested-copy-line-height">
       关于Docker engine  sealyun容器引擎基于moby构建，青出于蓝,兼容Docker所有操作，新增一些非常有用的功能 原生支持更牛逼的网络模式  docker的bridge网络模式是不能跨主机通信的，而我们通过定制实现了linux bridge的跨主机通信 增加了网络的ovs实现，容器可以划分vlan, 或者使用vxlan GRE等实现跨主机通信，且能做到网络租户隔离，避免产生ARP风暴  更好的支持runc，如hook的功能，在容器异常结束时执行回调脚本，这在有些场景下非常有用，如针对业务异常退出作些清理，而不用监听docker event 支持挂在磁盘时的反向覆盖，即容器里面的文件覆盖宿主机的，这也非常有用，比如mysql里已经有配置文件了，但是宿主机上没有，可能想把配置挂载出来，但是一般启动加 -v参数时外面空目录会覆盖里面的，这不是我们希望的，所以sealyun容器引擎支持这样的挂载： -v /etc/mysql.cnf&lt;-/etc/mysql.cnf 里面覆盖外面 -v /etc/mysql.cnf-&gt;/etc/mysql.cnf 外面覆盖里面，当然也支持正常的docker 挂载 稳定性更高，docker devicemapper在磁盘占满时 engine会defunt，甚至会导致重装docker engine也无法解决的问题，这是loop-lvm造成的，但是derict-lvm配置又麻烦，所以大家想用overlay存储驱动，不过在内核3.10或者更低版本是的问题的，比如在centos7.2上跑FROM ubuntu的镜像就会出错，所以我们对存储驱动进行了优化, sealyun container会跑的更稳定，如果大规模部署时会发现经常产生僵尸容器，我们的容器僵尸率比开源容器低的多   关于Swarm 管理UI对比  开源管理容器的UI都有bug，以shipyard为例，首先在scale up时没加锁，会导致节点重复分配，与swarm的兼容性就会出问题，然后容器数量一多大概300个时会很慢，然后界面上会出无故的错误。 开源工具分页支持差，不支持compose文件, 我们完全支持 我们的UI使用vue.js完全重写,单页面渲染上千个容器毫无压力 我们UI更简洁，功能更细致，如删除容器时其实是有三个参数是可以指定的，是否删除link,volume是否强制删除, 停止容器时支持stop timeout参数，这些在真正生产环境中都是非常必要的。 此外我们还在UI上支持了多集群管理与快速创建集群等功能  CI CD系统对比 
    </div>
  </div>
</div>
</div>
      
    </section>

<ul class="pagination">
    
    <li>
        <a href="/posts/" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li
    >
    <a href="/posts/page/2/" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/posts/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/posts/page/2/">2</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    class="active"><a href="/posts/page/3/">3</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/posts/page/4/">4</a></li>
    
    
    <li
    >
    <a href="/posts/page/4/" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li>
        <a href="/posts/page/4/" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>
</article>

    </main>
    <footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://lameleg.com/" >
    &copy; 2018 My New Hugo Site
  </a>
  








  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
